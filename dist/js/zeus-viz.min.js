/*!
 * Copyright (C) 2015, Symantec Corporation
 * All rights reserved.
 * zeus-viz v0.0.1
 */
"use strict";angular.module("zeus.viz",[]),angular.module("zeus.viz").directive("zsBarGraph",["$timeout",function(a){var b,c,d,e={top:20,right:20,bottom:30,left:80};return d=function(a,b){a.each(function(){var a,c=d3.select(this),d=c.text().trim().split(/\s+/).reverse(),e=[],f=0,g=1.1,h=c.attr("y"),i=parseFloat(c.attr("dy")),j=c.text(null).append("tspan").attr("x",0).attr("y",h).attr("dy",i+"em");for(a=d.pop();a;)e.push(a),j.text(e.join(" ")),j.node().getComputedTextLength()>b&&e.length>1&&(e.pop(),j.text(e.join(" ")),e=[a],j=c.append("tspan").attr("x",0).attr("y",h).attr("dy",++f*g+i+"em").text(a)),a=d.pop()})},c=function(a,b,c){if(a.values&&a.values.length){var f,g,h,i,j,k,l,m,n,o,p,q=b[0].parentElement,r=+a.leftMargin||e.left;h=d3.select(b[0]),i=h.select("g"),h.attr("width",0).attr("height",0),f=q.clientWidth-r-e.right,g=a.graphHeight?+a.graphHeight:q.clientHeight,g=g-e.top-e.bottom,h.attr("width",f+r+e.right).attr("height",g+e.top+e.bottom),n=d3.scale.ordinal().domain(a.seriesLabels).rangeRoundBands([g,0],.2),m=d3.scale.linear().rangeRound([0,f]),a.clampX?m.clamp(!0).domain([0,a.clampX]):(p=d3.max(a.values,function(a){return a}),m.domain([0,p])),k=d3.svg.axis().scale(m).orient("bottom").tickFormat(function(b){return a.tickFormatterX({$val:b})}).innerTickSize(-g),l=d3.svg.axis().scale(n).orient("left").innerTickSize(-f),i.attr("transform","translate("+r+","+e.top+")"),i.select("g.x-axis").attr("transform","translate(0,"+g+")").transition().duration(800).call(k),o=i.selectAll("g.x-axis .tick text"),o.call(d,f/o.size()),i.select("g.y-axis").transition().duration(800).call(l),j=i.select("g.chart-holder").selectAll("rect.bar").data(a.values),j.attr("class","bar").transition().duration(800).attr("fill",function(b,c){return a.colorGenerator({$pos:c})}).attr("y",function(b,c){return n(a.seriesLabels[c])}).attr("x",function(){return 0}).attr("height",function(){return n.rangeBand()}).attr("width",function(a){return m(a)}).attr("opacity",.75),j.enter().append("rect").attr("class","bar").attr("fill",function(b,c){return a.colorGenerator({$pos:c})}).transition().duration(800).attr("y",function(b,c){return n(a.seriesLabels[c])}).attr("x",function(){return 0}).attr("height",function(){return n.rangeBand()}).attr("width",function(a){return m(a)}).attr("opacity",.75),j.exit().transition().attr("width",function(){return 0}).remove(),j.on("mouseover",function(){c.show.apply(this,arguments),$(this).attr("opacity",1)}).on("mouseout",function(){c.hide.apply(this,arguments),$(this).attr("opacity",.75)})}},b=function(b,d,e){var f,g,h,i,j=$(d).parent(),k=$(window);b.leftMargin=e.leftMargin,f=d3.select(d[0]).attr("class","bar-graph"),i=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(a,c){return b.tooltipFormatter({$val:a,$pos:c})}),f.call(i),g=f.append("g"),g.append("g").attr("class","axis x-axis"),g.append("g").attr("class","axis y-axis"),g.append("g").attr("class","chart-holder"),j.is(":visible")&&c(b,d,i),b.$watch(function(){var a=j.is(":visible");return a},function(){j.is(":visible")&&c(b,d,i)}),k.on("resize.bar_graph_"+b.$id,function(){var e=j.is(":visible");h&&a.cancel(h),e&&(h=a(function(){c(b,d,i)},500))}),b.$on("$destroy",function(){k.off("resize.bar_graph_"+b.$id)}),b.$watch("lastUpdate",function(){j.is(":visible")&&c(b,d,i)})},{templateNamespace:"svg",template:"<svg></svg>",restrict:"E",replace:!0,link:b,scope:{values:"=",tickFormatterX:"&",lastUpdate:"=",seriesLabels:"=",colorGenerator:"&",graphHeight:"=",tooltipFormatter:"&",clampX:"=?"}}}]),angular.module("zeus.viz").directive("zsDonut",["$timeout",function(a){var b,c;return c=function(a,b,c,d){if(a.values&&a.values.length){c.attr("width",0).attr("height",0);var e,f,g,h,i,j,k,l,m,n,o,p=b[0].parentElement,q=p.clientWidth-20,r=p.clientHeight-20,s=a.showLegend?20:0,t=a.showLegend?10:0,u=[],v=0;.5*q>r&&(r=.5*q+s+t),c.attr("width",q).attr("height",r),e=Math.min(q,r-s-t)/2,i=Math.max(q,2*e)/2,j=Math.max(r-s-t,2*e)/2,m=c.select("g.donut-fragment").attr("transform","translate("+i+","+j+")"),o=a.title,m.select("text.donut-title").attr("x",0).attr("y",0).style("font-size",e/2+"px").text(o),m.select("text.donut-subtitle").attr("x",0).attr("y",e/4).style("font-size",e/6+"px").text(a.subtitle),n=c.select("g g.legend-fragment"),f=d3.svg.arc().outerRadius(.95*e).innerRadius(.75*e),h=function(a){var b=d3.interpolate(this._current,a);return this._current=b(0),function(a){return f(b(a))}},g=d3.layout.pie().sort(null).value(function(a){return a.value}),k=m.selectAll("path").data(g(a.values)),k.attr("fill",function(b,c){return a.segmentColor({$val:b.data,$index:c})}).each(function(a){this._current={startAngle:a.startAngle,endAngle:a.startAngle,value:0}}).transition().duration(800).attrTween("d",h),k.enter().append("path").attr("fill",function(b,c){return a.segmentColor({$val:b.data,$index:c})}).each(function(a){this._current={startAngle:a.startAngle,endAngle:a.startAngle,value:0}}).transition().duration(800).attrTween("d",h),k.exit().each(function(a){a.startAngle=2*Math.PI-.001,a.endAngle=2*Math.PI}).transition().duration(800).attrTween("d",h).remove(),k.on("mouseover",d.show).on("mouseout",d.hide),a.showLegend?(n.selectAll("g.legend-label text").remove(),n.selectAll("g.legend-label circle").remove(),l=n.selectAll("g.legend-label").data(a.values),l.enter().append("g").attr("class","legend-label").attr("transform",function(b,c){return"translate("+q/a.values.length*c+", 0)"}),l.attr("transform",function(b,c){return"translate("+q/a.values.length*c+", 0)"}),l.exit().remove(),l=n.selectAll("g.legend-label"),window.legendLabels=l,l.append("circle").attr("cx","8").attr("cy","8").attr("r","5").attr("fill",function(b,c){return a.segmentColor({$val:b,$index:c})}),l.append("text").attr("x","17").text(function(a){return a.label}).attr("y",function(a,b){var c=this.getComputedTextLength(),d=30+c;return u.push(0===b?d:u[b-1]+d),8}).attr("dy",5).attr("text-anchor","start"),l.attr("transform",function(a,b){return 0===b?"translate(0, 0)":"translate("+u[b-1]+", 0)"}),v=u[u.length-1],n.attr("transform","translate("+(q-v)/2+","+(r-s)+")")):l=n.selectAll("g.legend-label").remove()}},b=function(b,d,e){var f,g,h,i,j,k=$(d).parent(),l=$(window);b.showLegend=!!e.showLegend,f=d3.select(d[0]).attr("class","zs-donut"),j=d3.tip().attr("class","d3-tip").html(function(a){return a.data.label+": "+a.data.value}),f.call(j),g=f.append("g"),h=g.append("g").attr("class","donut-fragment"),h.append("text").attr("class","donut-title").attr("text-anchor","middle"),h.append("text").attr("class","donut-subtitle").attr("text-anchor","middle"),g.append("g").attr("class","legend-fragment"),k.is(":visible")&&c(b,d,f,j),b.$watch(function(){var a=k.is(":visible");return a},function(){k.is(":visible")&&c(b,d,f,j)}),l.on("resize.donut_"+b.$id,function(){var e=k.is(":visible");i&&a.cancel(i),e&&(i=a(function(){c(b,d,f,j)},500))}),b.$on("$destroy",function(){l.off("resize.donut_"+b.$id)}),b.$watch("lastUpdate",function(){k.is(":visible")&&c(b,d,f,j)})},{templateNamespace:"svg",template:"<svg></svg>",replace:!0,restrict:"E",scope:{percentage:"=?",segmentColor:"&",values:"=?",total:"=?",title:"@text",subtitle:"@",lastUpdate:"=?"},link:b}}]),angular.module("zeus.viz").directive("zsMultiColumnGraph",["$timeout",function(a){var b,c,d,e,f,g=Array.prototype.concat,h={top:20,right:20,bottom:30,left:80};return f=function(a,b){a.each(function(){var a,c=d3.select(this),d=c.text().trim().split(/\s+/).reverse(),e=[],f=0,g=1.1,h=c.attr("y"),i=parseFloat(c.attr("dy")),j=c.text(null).append("tspan").attr("x",0).attr("y",h).attr("dy",i+"em");for(a=d.pop();a;)e.push(a),j.text(e.join(" ")),j.node().getComputedTextLength()>b&&e.length>1&&(e.pop(),j.text(e.join(" ")),e=[a],j=c.append("tspan").attr("x",0).attr("y",h).attr("dy",++f*g+i+"em").text(a)),a=d.pop()})},e=function(a,b,c,d,e){var f=0;f=a.values[0].length,e.attr("class","bar").transition().duration(800).attr("fill",function(b){return a.colorGenerator({$series:b.z})}).attr("y",function(a){return c(a.y)}).attr("x",function(a){return b(a.x)+b.rangeBand()/f*a.z}).attr("width",function(){return b.rangeBand()/f}).attr("height",function(a){return d-c(a.y)}).attr("opacity",.9),e.enter().append("rect").attr("class","bar").attr("fill",function(b){return a.colorGenerator({$series:b.z})}).transition().duration(800).attr("y",function(a){return c(a.y)}).attr("x",function(a){return b(a.x)+b.rangeBand()/f*a.z}).attr("width",function(){return b.rangeBand()/f}).attr("height",function(a){return d-c(a.y)}).attr("opacity",.9),e.exit().transition().attr("height",function(){return 0}).remove()},d=function(a,b,c,d){d.attr("class","bar").transition().duration(800).attr("fill",function(b){return a.colorGenerator({$series:b.z})}).attr("y",function(a){return c(a.y0+a.y)}).attr("x",function(a){return b(a.x)}).attr("width",function(){return b.rangeBand()}).attr("height",function(a){return c(a.y0)-c(a.y0+a.y)}).attr("opacity",.9),d.enter().append("rect").attr("class","bar").transition().duration(800).attr("fill",function(b){return a.colorGenerator({$series:b.z})}).attr("y",function(a){return c(a.y0+a.y)}).attr("x",function(a){return b(a.x)}).attr("width",function(){return b.rangeBand()}).attr("height",function(a){return c(a.y0)-c(a.y0+a.y)}).attr("opacity",.9),d.exit().transition().attr("height",function(){return 0}).remove()},c=function(a,b,c){if(a.values&&a.values.length){var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w=b[0].parentElement,x=+a.leftMargin||h.left,y=[],z=0;for(k=d3.select(b[0]),l=k.select("g"),k.attr("width",0).attr("height",0),i=w.clientWidth-x-h.right,j=w.clientHeight-h.top-h.bottom,k.attr("width",i+x+h.right).attr("height",j+h.top+h.bottom),z=a.values[0].length,s=0;z>s;s++)y.push([]);for(s=0;s<a.values.length;s++)for(u=a.values[s],t=0;t<u.length;t++)y[t].push({x:s,y:u[t],z:t,y0:0});o=d3.scale.ordinal().rangeRoundBands([0,i],.33).domain(d3.range(a.values.length)),p=d3.scale.linear().range([j,0]),m="stack"===a.mode?g.apply([],d3.layout.stack()(y)):g.apply([],y),a.clampY?p.clamp(!0).domain([0,a.clampY]):(v=d3.max(m,function(a){return a.y0+a.y}),p.domain([0,v])),q=d3.svg.axis().scale(o).orient("bottom").tickFormat(function(b){return a.tickFormatterX({$pos:b})}).innerTickSize(-j),r=d3.svg.axis().scale(p).orient("left").tickFormat(function(b){return a.tickFormatterY({$val:b})}).innerTickSize(-i).tickPadding(10),l.attr("transform","translate("+x+","+h.top+")"),l.select("g.x-axis").attr("transform","translate(0,"+j+")").transition().duration(800).call(q).selectAll(".tick text").call(f,o.rangeBand()),l.select("g.y-axis").transition().duration(800).call(r),a.labelAxisY&&!a.renderAxixLable&&(l.select("g.y-axis").append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text(a.labelAxisY),a.renderAxixLable=!0),n=l.select("g.chart-holder").selectAll("rect").data(m),"stack"===a.mode?d(a,o,p,n):e(a,o,p,j,n),n.on("mouseover",function(){c.show.apply(this,arguments),$(this).attr("opacity",1)}).on("mouseout",function(){c.hide.apply(this,arguments),$(this).attr("opacity",.9)})}},b=function(b,d,e){var f,g,h,i,j=$(d).parent(),k=$(window);b.leftMargin=e.leftMargin,b.renderAxixLable=!1,b.clampY=+e.clampY,f=d3.select(d[0]).attr("class","multi-column-graph"),i=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(a){return b.tooltipFormatter("stack"===b.mode?{$pos:a.x,$samples:b.values[a.x]}:{$series:a.z,$pos:a.x,$val:a.y})}),f.call(i),g=f.append("g"),g.append("g").attr("class","axis x-axis"),g.append("g").attr("class","axis y-axis"),g.append("g").attr("class","chart-holder"),j.is(":visible")&&c(b,d,i),b.$watch(function(){var a=j.is(":visible");return a},function(){j.is(":visible")&&c(b,d,i)}),k.on("resize.multi_column_"+b.$id,function(){var e=j.is(":visible");h&&a.cancel(h),e&&(h=a(function(){c(b,d,i)},500))}),b.$on("$destroy",function(){k.off("resize.multi_column_"+b.$id)}),b.$watch("lastUpdate",function(){j.is(":visible")&&c(b,d,i)}),b.$watch("mode",function(){j.is(":visible")&&c(b,d,i)})},{templateNamespace:"svg",template:"<svg></svg>",replace:!0,restrict:"E",link:b,scope:{values:"=",tickFormatterX:"&",tickFormatterY:"&",lastUpdate:"=",colorGenerator:"&",tooltipFormatter:"&",mode:"@",labelAxisY:"@"}}}]),angular.module("zeus.viz").directive("zsPunchCard",["$timeout",function(a){var b,c,d=30,e=85,f=30,g=20;return c=function(a,b,c){if(a.punchData&&a.punchData.length){var h,i,j,k,l,m,n,o,p,q,r,s=b[0].parentElement,t=[],u=+a.leftMargin||e,v=a.punchData[0].samples.length;j=d3.select(b[0]),j.attr("width",0).attr("height",0),h=s.clientWidth,i=s.clientHeight,p=Math.min((h-d-u-g)/v-2,12),j.attr("width",h).attr("height",i),t=[],o=0,angular.forEach(a.punchData,function(a,b){t=t.concat(a.samples.map(function(a,c){return a>o&&(o=a),{punchPosition:[b,c],value:a}}))}),k=d3.scale.linear().domain([0,v-1]).rangeRound([u,h-d-g]),m=d3.svg.axis().scale(k).orient("bottom").ticks(v).tickFormat(function(b,c){var d=t[c].punchPosition;return a.tickFormatterX({$pos:d})}),l=d3.scale.ordinal().domain(a.punchData.map(function(a,b){return b})).rangePoints([d,i-2*d-f],0,1),n=d3.svg.axis().scale(l).orient("left").tickFormat(function(b,c){return a.tickFormatterY({$val:c,$pos:b})}),j.select("g.x-axis").attr("class","axis x-axis").attr("transform","translate(0, "+(i-d-f)+")").call(m),j.select("g.y-axis").attr("transform","translate("+(u-d)+", -0)").call(n),q=d3.scale.linear().domain([0,o]).range([0,p]),r=j.selectAll("circle").data(t),r.exit().transition().attr("r",function(){return"0"}).remove(),r.attr("class","punch-dot").transition().duration(800).attr("cx",function(a){return k(a.punchPosition[1])}).attr("cy",function(a){return l(a.punchPosition[0])}).attr("fill",function(b){return a.punchColor({$pos:b.punchPosition})}).attr("r",function(a){var b=q(a.value);return b}),r.enter().append("circle").attr("class","punch-dot").attr("cx",function(a){return k(a.punchPosition[1])}).attr("cy",function(a){return l(a.punchPosition[0])}).attr("fill",function(b){return a.punchColor({$pos:b.punchPosition})}).transition().duration(800).attr("r",function(a){var b=q(a.value);return b}),r.on("mouseover",c.show).on("mouseout",c.hide)}},b=function(b,d,e){var f,g,h,i=$(d).parent(),j=$(window);b.leftMargin=e.leftMargin,g=d3.select(d[0]).attr("class","punch-card"),g.append("g").attr("class","axis y-axis"),g.append("g").attr("class","axis x-axis"),h=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(a){return b.tooltipFormatter({$val:a.value,$pos:a.punchPosition})}),g.call(h),i.is(":visible")&&c(b,d,h),b.$watch(function(){var a=i.is(":visible");return a},function(){i.is(":visible")&&c(b,d,h)}),j.on("resize.punch_card_"+b.$id,function(){var e=i.is(":visible");f&&a.cancel(f),e&&(f=a(function(){c(b,d,h)},500))}),b.$on("$destroy",function(){j.off("resize.punch_card_"+b.$id)}),b.$watch("lastUpdate",function(){i.is(":visible")&&c(b,d,h)})},{templateNamespace:"svg",template:"<svg></svg>",replace:!0,restrict:"E",link:b,scope:{punchData:"=",tickFormatterY:"&",tickFormatterX:"&",punchColor:"&",lastUpdate:"=",tooltipFormatter:"&"}}}]);